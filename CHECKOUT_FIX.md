# Checkout Fix - Shipping Address Issue

## Problem

The backend was throwing a 404 error: "Shipping address not found" when trying to place an order.

## Root Cause

The backend expected `shippingAddressId` (the MongoDB \_id of an address from the user's `shippingAddresses` array), but the frontend was sending a full `shippingAddress` object with different field names (street, postalCode) instead of the correct field names (addressLine1, addressLine2, pincode).

## Backend Expectations

```javascript
// backend/src/controllers/order.controller.js (line 22-27)
const shippingAddress = req.user.shippingAddresses.id(shippingAddressId);
if (!shippingAddress) {
  throw new ApiError(404, "Shipping address not found");
}
```

The backend uses Mongoose's subdocument `.id()` method to find the address by its `_id` within the user's `shippingAddresses` array.

## User Model Address Structure

```javascript
shippingAddresses: [
  {
    _id: ObjectId, // Auto-generated by MongoDB
    addressLine1: String,
    addressLine2: String,
    city: String,
    state: String,
    pincode: String,
    country: String,
    isDefault: Boolean,
  },
];
```

## Solution

Updated `Checkout.jsx` to:

1. **Use `selectedAddressId` state** instead of `shippingAddress` object
2. **Select from existing addresses** - Display user's saved addresses as clickable cards
3. **Send only the address ID** to the backend:
   ```javascript
   const orderData = {
     shippingAddressId: selectedAddressId,
     paymentMethod,
     notes,
   };
   ```

## New Features Added

- ✅ Visual address selection with highlighting
- ✅ Default address pre-selected on load
- ✅ Checkmark indicator for selected address
- ✅ "Add New Address" button (form placeholder included)
- ✅ Fallback UI when no addresses exist
- ✅ Proper validation (must select an address before placing order)

## Testing Steps

1. Make sure you have at least one address saved in your profile
2. Go to checkout page
3. You should see your saved addresses as selectable cards
4. The default address (or first address) should be pre-selected
5. Click "Place Order"
6. Order should be created successfully without the 404 error

## Next Steps

If you want to complete the "Add New Address" functionality in the checkout page, you'll need to:

1. Create an API endpoint or use existing auth API to add address
2. Update the user state after adding new address
3. Auto-select the newly added address

For now, users can add addresses from their profile page and use them during checkout.
